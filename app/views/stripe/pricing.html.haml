- content_for(:container) do
  - @plans.each_slice(3) do |plans|
    .row
      - plans.each do |plan|
        - content_for("heading-#{plan.object_id}") do
          %h3= plan[:instance].name
        - content_for("footer-#{plan.object_id}") do
          .center-block{:style => 'text-align:center'}
            - if !@account.customer_payment
              = form_tag account_billing_order_path(plan[:instance].id), :method => :post do
                = hidden_field_tag :plan_id, plan[:instance].id
                = javascript_include_tag 'https://checkout.stripe.com/checkout.js', :class => 'stripe-button', 'data-key' => @publish_key, 'data-image' => '/checkout-image.png', 'data-name' => plan[:instance].name, 'data-description' => plan[:instance].summary, 'data-amount' => plan[:instance].generated_cost(:integer), 'data-email' => @account.email || current_user.email, 'data-label' => 'Subscribe', 'data-panel-label' => 'Pay {{amount}}/mo'
            - elsif @account.customer_payment.plans.include?(plan[:instance])
              %a.btn.btn-success.disabled{:href => '#'}
                Subscribed!
            - else
              %a.btn.btn-success{:href => '#'}
                Upgrade!

        %div{:class => "col-md-#{12 / plans.size}"}
          :ruby
            locals = {
              :id => "plan-#{plan[:instance].id}",
              :heading => yield("heading-#{plan.object_id}"),
              :footer => yield("footer-#{plan.object_id}"),
              :panel_class => 'pricing',
              :panel_content => render(
                :partial => 'plan',
                :locals => {
                  :plan => plan
                }
              )
            }
          = render(:partial => 'layouts/panel', :locals => locals)

= render(:partial => 'layouts/container')
